<!DOCTYPE html>

<html lang="vi">
<head>
<meta charset="UTF-8">
<title>ThaoVy</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}

/* üî• CH·ªà ƒê·ªîI LINK N·ªÄN ·ªû ƒê√ÇY */
:root{
  --bg-url: url("https://hoanghamobile.com/tin-tuc/wp-content/webp-express/webp-images/uploads/2024/05/hinh-mau-hong-3.jpg.webp");
}

body{
  margin:0;
  font-family:'Poppins',sans-serif;

  background:
    linear-gradient(rgba(10,20,40,.35),rgba(10,20,40,.45)),
    var(--bg-url);

  background-size:cover;
  background-position:center;
  background-attachment:scroll;

  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
}

.container{
  text-align:center;
  color:#fff;
  text-shadow:0 2px 8px rgba(0,0,0,.6);
  width:100%;
  max-width:500px;
}

.title{
  font-size:clamp(24px,5vw,42px);
  font-weight:700;
  margin-bottom:20px;
}

.wheel-wrapper{
  position:relative;
  width:min(90vw,420px);
  height:min(90vw,420px);
  margin:auto;
}

canvas{
  width:100%;
  height:100%;
  border-radius:50%;
  box-shadow:
    0 0 30px rgba(0,0,0,.6),
    inset 0 0 25px rgba(255,255,255,.25);
  background:transparent;
}

/* ===== POINTER ===== */
.pointer{
  position:absolute;
  top:-10px;
  left:50%;
  transform:translateX(-50%);
  width:0;
  height:0;
  border-left:clamp(10px,3vw,18px) solid transparent;
  border-right:clamp(10px,3vw,18px) solid transparent;
  border-bottom:clamp(24px,6vw,42px) solid #ff4757;
  filter:drop-shadow(0 2px 6px rgba(0,0,0,.6));
}

.spin-btn{
  margin-top:24px;
  padding:14px 36px;
  font-size:clamp(16px,4vw,20px);
  font-weight:600;
  border:none;
  border-radius:50px;
  cursor:pointer;
  color:#fff;
  background:linear-gradient(45deg,#ff6a00,#ff3d00);
  touch-action:manipulation;
}

.spin-btn:active{
  transform:scale(.97);
}

.result{
  margin-top:20px;
  font-size:clamp(18px,4.5vw,28px);
  font-weight:700;
  min-height:40px;
}
</style>

</head>

<body>
<div class="container">
  <div class="title">K·∫ø ho·∫°ch gi√∫p Th·∫£o Vy l√†m gi√†u üòéüíµ</div>

  <div class="wheel-wrapper">
    <div class="pointer"></div>
    <canvas id="wheel"></canvas>
  </div>

<button class="spin-btn" onclick="spin()">QUAY THUI</button>

  <div class="result" id="result"></div>
</div>

<!-- √¢m th·∫Øng -->

<audio id="winSound" preload="auto">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
</audio>

<!-- nh·∫°c n·ªÅn -->

<audio id="bgMusic" loop preload="auto">
  <source src="https://assets.mixkit.co/music/preview/mixkit-game-level-music-689.mp3" type="audio/mpeg">
</audio>

<!-- √¢m quay -->

<audio id="spinTick" preload="auto">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-slot-machine-spin-1935.mp3" type="audio/mpeg">
</audio>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
// ===== AUDIO =====
const bgMusic=document.getElementById("bgMusic");
const spinTick=document.getElementById("spinTick");
const winSound=document.getElementById("winSound");

function safePlay(audio){
  if(!audio) return;
  audio.currentTime=0;
  const p=audio.play();
  if(p!==undefined){p.catch(()=>{});}
}

window.addEventListener("load",()=>{
  bgMusic.load();
  spinTick.load();
  winSound.load();
});

document.addEventListener("click",function initMusic(){
  bgMusic.volume=0.4;
  safePlay(bgMusic);
  document.removeEventListener("click",initMusic);
});

// ===== WHEEL =====
const prizes=["Plan A","Plan B"];
const colors=["#ff7675","#74b9ff"];

const canvas=document.getElementById("wheel");
const ctx=canvas.getContext("2d");

let center=0;
const arc=Math.PI*2/prizes.length;

function resizeCanvas(){
  const size = canvas.clientWidth;
  canvas.width = size;
  canvas.height = size;
  center = canvas.width / 2;
}
resizeCanvas();
window.addEventListener("resize",()=>{
  resizeCanvas();
  drawWheel();
});

let rotation=0;
let spinning=false;

// DRAW
function drawWheel(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  for(let i=0;i<prizes.length;i++){
    const start=rotation+i*arc;
    const end=start+arc;

    ctx.beginPath();
    ctx.fillStyle=colors[i%colors.length];
    ctx.moveTo(center,center);
    ctx.arc(center,center,center-5,start,end);
    ctx.closePath();
    ctx.fill();

    ctx.save();
    ctx.translate(center,center);
    ctx.rotate(start+arc/2);
    ctx.fillStyle="#fff";
    ctx.strokeStyle="rgba(0,0,0,.7)";
    ctx.lineWidth=5;
    ctx.font=`bold ${Math.max(16,center*0.14)}px Poppins`;
    ctx.textAlign="center";
    ctx.textBaseline="middle";

    const textRadius=center*0.6;
    ctx.strokeText(prizes[i],textRadius,0);
    ctx.fillText(prizes[i],textRadius,0);
    ctx.restore();
  }
}
drawWheel();

// SPIN
function spin(){
  if(spinning) return;
  spinning=true;

  document.querySelector(".spin-btn").disabled=true;
  document.getElementById("result").innerText="";

  spinTick.loop=true;
  safePlay(spinTick);

  const index=Math.floor(Math.random()*prizes.length);
  const slice=2*Math.PI/prizes.length;
  const randomOffset=(Math.random()-0.5)*slice*0.6;
  const targetRotation=(Math.PI*1.5)-(index*slice+slice/2)+randomOffset;

  const spins=6*2*Math.PI;
  const finalRotation=spins+targetRotation;
  const startRotation=rotation;
  const change=finalRotation-startRotation;
  const duration=4000;

  let start=null;

  function animate(ts){
    if(!start) start=ts;
    const progress=ts-start;
    const t=Math.min(progress/duration,1);
    const ease=1-Math.pow(1-t,3);

    rotation=startRotation+change*ease;
    drawWheel();

    if(t<1) requestAnimationFrame(animate);
    else finish(index);
  }
  requestAnimationFrame(animate);
}

// FINISH
function finish(index){
  spinning=false;
  document.querySelector(".spin-btn").disabled=false;

  spinTick.pause();
  spinTick.currentTime=0;

  rotation = rotation % (2*Math.PI);
  drawWheel();

  const prize=prizes[index].trim();
  document.getElementById("result").innerHTML =
    "üéâ <b>Ti·∫øn h√†nh theo " + prize + "</b> ü•≥<br>" +
    "<span style='font-size:18px;opacity:.9'>G·ª≠i k·∫øt qu·∫£ cho t·ªõ nh√©</span>";

  celebrationPro();
}

// CONFETTI
function celebrationPro(){
  safePlay(winSound);

  const end=Date.now()+4000;
  (function frame(){
    confetti({particleCount:8,angle:60,spread:70,origin:{x:0,y:.7}});
    confetti({particleCount:8,angle:120,spread:70,origin:{x:1,y:.7}});
    if(Date.now()<end) requestAnimationFrame(frame);
  })();

  setTimeout(()=>{
    confetti({
      particleCount:250,
      spread:170,
      startVelocity:40,
      gravity:.9,
      ticks:300,
      origin:{x:.5,y:-.1}
    });
  },400);
}
</script>

</body>
</html>
